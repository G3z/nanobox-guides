<!DOCTYPE html><html lang=en><head><title>Nanobox</title><meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel=stylesheet href=/style.css><link href="//fonts.googleapis.com/css?family=Lato:400,400italic" rel=stylesheet type=text/css><link rel=icon type=image/png href=/assets/favicon.png></head><body><div class=main-wrapper><div style=height:49px; class=top-nav-wrapper><div class=top-nav><a href="/" class=logo><div class=img></div><div class=company>Nanobox</div></a><div class=index-items><div id=local-link data-target=#local class="jumper active">Local</div><div id=deploy-link data-target=#deploy class=jumper>Deploy</div><div id=live-link data-target=#live class=jumper>Live</div></div><div class=menu><div class=nav><a href=http://dashboard.nanobox.io>Sign Up</a></div></div><div class=hamburg-icon><img data-src=hamburg-menu class=shadow-icon></div></div></div><div class=content-area><div class=article-page><div id=left-nav class=left-nav><div class=article-nav><div class=title></div><div class=articles></div></div></div><div class=main><div class=markdown><h1 id=rails-connecting-a-database>Rails: Connecting a Database</h1><p>Once you have an app <a href=getting-started.html#up-and-running>up and running</a> the next thing may need to do is connect a database.</p><p>The guide is broken down into three sections:</p><ol><li><a href=adding-a-data-component>Adding a data component</a></li><li><a href=connecting-your-application>Connecting your application</a></li><li><a href=testing-the-connection>Testing the connection</a></li></ol><h2 id=adding-a-data-component>Adding a data component</h2><p>Nanobox applications are comprised of <a href>components</a>. If your application has a database it needs to connect to then you can add <a href>a data component</a>.</p><h4 id=specify-the-component>Specify the component</h4><p>To add a data component to your app, simply specify what you need in the <code>boxfile.yml</code>:</p><pre><code class=lang-yaml>code.build:

  # because we&#39;re using rails we need to tell nanobox that we need ruby in our container
  engine: &quot;ruby&quot;

# specify that we need a data component (called &quot;db&quot;)
data.db:

  # for this example we&#39;ll used postgresql as our database
  image: nanobox/postgresql
</code></pre><h4 id=provision-the-component>Provision the component</h4><p>In order for nanobox to provision your data component, you&#39;ll need to rebuild your environment and deploy it to the development runtime:</p><pre><code class=lang-bash># build your new environment
nanobox build

# deploy the environment to the development runtime
nanobox dev deploy
</code></pre><h2 id=connecting-your-application>Connecting your application</h2><p>When a data component is provisioned with nanobox, unique connection credentials are generated along with <a href>environment variables</a>. The keys for each variable is based on the <a href>component ID</a> in your boxfile.yml. Using environment variables in this way allows your application to be secure yet portable.</p><h4 id=environment-variables>Environment Variables</h4><p>With the data component added, nanobox would generate the following environment variables:</p><pre><code class=lang-bash>DATA_DB_HOST = &lt;your-apps-ip&gt;
DATA_DB_USER = nanobox
DATA_DB_PASS = &lt;unique-password&gt;
</code></pre><p><strong><em>ADVANCED TIP:</em></strong> You can list all environment variables your dev environment has available using <code>nanobox dev console</code>:</p><pre><code class=lang-bash># console into the dev environment
nanobox dev console

# list all environment variables
env
</code></pre><h4 id=connection-credentials>Connection Credentials</h4><p>Data component ports will always be the default port for that service. Database connections that require a name, should use <code>gonano</code>.</p><p>For rails, you&#39;ll need to modify your <code>config/database.yml</code> to connect your application:</p><pre><code class=lang-yml>development:
  adapter: postgresql
  encoding: unicode
  database: &lt;%= ENV[&#39;DATA_DB_NAME&#39;] %&gt;
  pool: 5
  host: &lt;%= ENV[&#39;DATA_DB_HOST&#39;] %&gt;
  username: &lt;%= ENV[&#39;DATA_DB_USER&#39;] %&gt;
  password: &lt;%= ENV[&#39;DATA_DB_PASS&#39;] %&gt;
</code></pre><h2 id=testing-the-connection>Testing the connection</h2><p>With your data component provisioned, and your application updated to connect to it, it&#39;s time to test that connection. You can do this in one of several ways.</p><h4 id=connecting-an-external-client>Connecting an external client</h4><p>You can test your connection by connecting an external client to your database using the <a href=#connection-credentials>connection credentials</a> above.</p><h4 id=running-your-application>Running your application</h4><p>You can also test your connection by simply trying to run your application and see if it is able to connect. In rails we could run the following command:</p><pre><code class=lang-bash># console into the dev environment
nanobox dev console

# attempt to setup the database
bundle exec rake db:setup
</code></pre><h2 id=now-what->Now what?</h2><p>Now that you have a database connected to your application whats next? Think about what else your application might need and hopefully the topics below will help you get started with the next steps of your development!</p><ul><li><a href=preparing-for-production.html>Preparing for production</a></li><li><a href=launching-your-app.html>Launching your app</a></li></ul></div></div></div></div></div><script src=/js/libs.js></script><script src=/js/main.js></script><script src=https://use.typekit.net/cqd5kth.js></script><script>try{Typekit.load({ async: true });}catch(e){}</script><script src=/js/article-groups/rails.js></script><script>article = new Article("Connecting a Database", "rails", "ruby,rails")

</script><script type=text/javascript>$mainwrapper = $(".main-wrapper");
castShadows( $('.main-wrapper') );
topNav = new nanobox.TopNav( $(".top-nav") );
</script><script type=text/javascript>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-78086337-1', 'auto');
ga('send', 'pageview');

  </script></body></html>